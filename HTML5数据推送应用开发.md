#《HTML5数据推送应用开发》
---
##第一章 SSE及其他
| |ie支持|简洁性|二进制|单双工|
|---|---|---|---|---|
|SSE|不支持|运行在HTTP/HTTPS上|基于文本|只能推|
|WebSocket|ie10| |二进制|双工|

```
SSE这个东西听起来很像ajax就能做出polyfill来，
因为ie的ajax不能在readyState为3的时候读取到数据，
所以不能像其他浏览器那样，在一个HTTP连接里面多次接收信息。
```
||服务器事件频繁|客户端事件频繁|客户端事件事件可预测|延迟重要|无线连接|耗电量|大文件|
|---|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|SSE|√|(只能推)||√|√|√||
|WebSocket|√|√||√|√|√|(在不稳定连接中，丢包严重会阻塞后面的通知)|
|拉取|||√(保持连接消耗资源)|||(更耗电)||



##第二章 玩转SSE

```
学了一下node api
```
* 1.respone.write() //返回值为Bool，内容是否送到客户端、否则还在内存中 
* 2.request.connection.on("close") //这个close事件表示客户端断掉了连接

##第三章 迷人的真实数据推送应用

```
并没有学到什么有用的东西，
只是知道了要设置种子，让随机数函数返回可复现的数据，
以便于测试。
```
##第四章 别安于现状
```
没学到啥
```
##第五章 走出象牙塔，打造产品级品质
```
介绍了长连接（心跳）的写法，这个本身比较简单。

后面还介绍了手动写心跳的原因：
```
* SSE 内置重连只能处理套接字关闭这一种引发错误的情况，而其他情况还有很多。
* 手动心跳可以在服务宕掉时尝试重连，内置重连不行。

```
其余还有一些小细节：
```
* 心跳的间隔应该设在15~40s间，不然浏览器或中转媒介会认为出错了，并关闭套接字，尝试重连，这样整体上会造成更多负载。
* 心跳的间隔应该比内置重连的间隔大。

```
接下来就是让连接在不必要的时候断开，在特定的时间点上重连的，一些技巧：
```
* 如果所有客户端都在同一时点重连流量会变得非常惊人，解决办法是让一些客户早一点连接。

```
Last-Event-ID请求头的介绍：
```
* 指定每条信息的id的方法是：每条信息里面多一行```id:xxx```
* Last-Event-ID在重连的时候发送。
* XMLHttpRequest 和ActiveXObject 的向后兼容方案中， 可以用setRequestHeader() 函数来模拟这种行为。
* 坏消息是，在使用EventSource 时不能手动地指定一个值。那意味着在一个全新的连接中完全不能指定它的值。
* 可以在url里面指定开始的时候的id，在重连的时候使用Last-Event-ID


```
还发现了一些奇葩东西：
```
* **原生SSE不支持POST**




##第六章 向后兼容：其他数据推送策略


##第八章 关于SSE的其他标准
```
介绍了一些SSE标准里面相当鸡肋的东西
```

```
SSE的事件机制，event:行，每一条信息都有一个默认的event:message行
但是实际上如果data：行是一个json，大可以把事件类型放在json里面，
event:行的唯一好处大概就是，支持原生的事件绑定机制吧。
```

```
对多行数据的处理：
data:Roses are red
data:Violets are blue
data:No need to escape
data:When you do as I do
(空行)

客户端收到的东西是：
Roses are red\nViolets are blue\nNo need to escape\nWhen you do as I do

只有遇到空行时，客户端才会进行一次事件响应
```

##第九章 认证授权：谁在敲门
```
再一次重申了SSE不能POST这个事实

其他一些有用的信息如下：
```
* SSE支持SSL和CORS
* SSE的CORS支持在Chrome 25、Safari 6下有bug
* SSE的withCredentials参数，9.11节有一个详细的介绍，**值得复习**

//todo
9.12　CORS和向后兼容方案 
从这里开始没有认真看，要看看